import{j as e,r as l,L as P,S as x}from"./app-NQZYwZxE.js";import{A as E,C as T}from"./app-layout-DuMOQUr6.js";import{B}from"./badge-CysAJUxd.js";import{B as a}from"./app-logo-icon-D_Rp5eSv.js";import{I as m}from"./input-DVTDn1Ue.js";import{C as v}from"./card-DUep4rP4.js";import{S as A,a as L,b as y,c as M,d as _}from"./select-CTrUruAo.js";import{D as z,a as R,b as H,c as I}from"./dialog-CHCQddYa.js";import{F as V}from"./file-text-BlbqMGnd.js";import{S as O}from"./search-D5tqskJn.js";import{F as $}from"./file-down-P3Ac7s6P.js";import{E as q}from"./eye-ADaAT4GR.js";import{C as K}from"./chevron-left-BOWI_oDY.js";import"./index-B7uAbRVs.js";import"./index-oQJ4WyGj.js";import"./check-BUYNMoAp.js";function C(s){return s&&typeof s.card_brand<"u"}function S(s){return s&&typeof s.reference_number<"u"}function U(s){return s&&typeof s.received_amount<"u"}function G({payment:s,isOpen:r,onOpenChange:i}){return s?e.jsx(z,{open:r,onOpenChange:i,children:e.jsxs(R,{className:"sm:max-w-xl",children:[e.jsx(H,{children:e.jsxs(I,{children:["Detalles del Pago #",s.id]})}),e.jsxs("div",{className:"py-4 space-y-4 max-h-[70vh] overflow-y-auto pr-4",children:[C(s.detailable)&&e.jsxs("div",{className:"p-4 border rounded-lg bg-slate-50 space-y-1",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Pago con Tarjeta"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Marca:"})," ",s.detailable.card_brand]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Terminación:"})," **** ",s.detailable.last_four_digits]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Cód. Transacción:"})," ",s.detailable.transaction_code||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Cód. Autorización:"})," ",s.detailable.authorization_code||"N/A"]})]}),S(s.detailable)&&e.jsxs("div",{className:"p-4 border rounded-lg bg-slate-50 space-y-1",children:[e.jsxs("h4",{className:"font-semibold mb-2",children:["Pago Bancario (",s.detailable.type,")"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"N° Referencia:"})," ",s.detailable.reference_number]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha Transacción:"})," ",new Date(s.detailable.transaction_date).toLocaleDateString("es-ES")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Banco Origen:"})," ",s.detailable.origin_bank||"N/A"]})]}),U(s.detailable)&&e.jsxs("div",{className:"p-4 border rounded-lg bg-slate-50 space-y-1",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Pago en Efectivo"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Monto Recibido:"})," $",parseFloat(s.detailable.received_amount).toFixed(2)]})]}),(S(s.detailable)||C(s.detailable))&&s.detailable.receipt&&e.jsx("a",{href:`/storage/${s.detailable.receipt}`,target:"_blank",rel:"noopener noreferrer",children:e.jsxs(a,{variant:"secondary",className:"w-full",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Ver Comprobante"]})})]})]})}):null}function de({payments:s,filters:r,statusOptions:i}){const[c,h]=l.useState(r.search||""),[n,j]=l.useState(r.status||""),[o,u]=l.useState(r.date_from||""),[d,g]=l.useState(r.date_to||""),[f,p]=l.useState(null),b=()=>{x.get(route("admin.reports.payments"),{search:c||void 0,status:n||void 0,date_from:o||void 0,date_to:d||void 0},{preserveState:!0,replace:!0})},D=()=>{h(""),j(""),u(""),g(""),x.get(route("admin.reports.payments"))},N=t=>{t&&x.get(t,{preserveState:!0,preserveScroll:!0})},w=t=>t.includes("Cash")?"Efectivo":t.includes("Card")?"Tarjeta":t.includes("Bank")?"Banco":"Desconocido",k=()=>{const t=new URLSearchParams({search:c||"",status:n==="all"?"":n||"",date_from:o||"",date_to:d||""}).toString();window.location.href=route("admin.reports.export.payments")+"?"+t};return e.jsxs(E,{children:[e.jsx(P,{title:"Historial de Pagos"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 rounded-xl p-4 sm:p-6",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Historial de Pagos"}),e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Buscar"}),e.jsx(m,{placeholder:"Nombre o N° Certificación...",value:c,onChange:t=>h(t.target.value),onKeyPress:t=>t.key==="Enter"&&b()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Estado"}),e.jsxs(A,{value:n,onValueChange:j,children:[e.jsx(L,{children:e.jsx(y,{placeholder:"Todos los estados"})}),e.jsxs(M,{children:[e.jsx(_,{value:"all",children:"Todos"}),Object.entries(i).map(([t,F])=>e.jsx(_,{value:t,children:F},t))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Desde"}),e.jsx(m,{type:"date",value:o,onChange:t=>u(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Hasta"}),e.jsx(m,{type:"date",value:d,onChange:t=>g(t.target.value)})]}),e.jsxs("div",{className:"lg:col-span-4 flex justify-end space-x-2 mt-2",children:[e.jsxs(a,{onClick:b,children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Filtrar"]}),e.jsx(a,{variant:"outline",onClick:D,children:"Limpiar"}),e.jsxs(a,{variant:"secondary",onClick:k,children:[e.jsx($,{className:"h-4 w-4 mr-2"})," Exportar"]})]})]})}),e.jsxs(v,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center p-4 font-medium",children:"Cliente / Certificación"}),e.jsx("th",{className:"text-center p-4 font-medium",children:"Monto"}),e.jsx("th",{className:"text-center p-4 font-medium",children:"Método"}),e.jsx("th",{className:"text-center p-4 font-medium",children:"Estado"}),e.jsx("th",{className:"text-center p-4 font-medium",children:"Fecha"}),e.jsx("th",{className:"text-center p-4 font-medium",children:"Acciones"})]})}),e.jsx("tbody",{children:s.data.length>0?s.data.map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsxs("td",{className:"p-4 text-center text-gray-700",children:[e.jsx("div",{className:"font-medium",children:t.certification.applicantName}),e.jsx("div",{className:"text-sm text-gray-500",children:t.certification.certification_number||"N/A"})]}),e.jsxs("td",{className:"p-4 text-center text-gray-700",children:["$",parseFloat(t.amount).toFixed(2)]}),e.jsx("td",{className:"p-4 text-center text-gray-700",children:w(t.detailable_type)}),e.jsx("td",{className:"p-4 text-center text-gray-700",children:e.jsx(B,{children:i[t.status]})}),e.jsx("td",{className:"p-4 text-center text-gray-700",children:new Date(t.payment_date).toLocaleDateString("es-ES")}),e.jsx("td",{className:"p-4 text-center text-gray-700",children:e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>p(t),children:[e.jsx(q,{className:"h-4 w-4 mr-1"})," Ver Detalles"]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-8 text-center text-gray-500",children:"No se encontraron pagos que coincidan con los filtros."})})})]})}),s.data.length>0&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-t",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Mostrando ",s.from," a ",s.to," de ",s.total]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>N(s.prev_page_url),disabled:!s.prev_page_url,children:[e.jsx(K,{className:"h-4 w-4"})," Anterior"]}),e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>N(s.next_page_url),disabled:!s.next_page_url,children:["Siguiente ",e.jsx(T,{className:"h-4 w-4"})]})]})]})]})]}),e.jsx(G,{payment:f,isOpen:!!f,onOpenChange:t=>{t||p(null)}})]})}export{de as default};
