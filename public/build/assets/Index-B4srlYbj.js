import{r as u,j as e,R as g,c as le,L as Me,S as $}from"./app-NQZYwZxE.js";import{d as B,a as K,B as E}from"./app-logo-icon-D_Rp5eSv.js";import"./index-B7uAbRVs.js";import{s as de,t as De,v as ke,w as Oe,r as Te,A as Le,S as $e,T as F}from"./app-layout-DuMOQUr6.js";import{C as V}from"./card-DUep4rP4.js";import{I as z}from"./input-DVTDn1Ue.js";import{L as k}from"./label-DP57cNBy.js";import{D as Q,a as W,b as X,c as Z,e as ee,f as te}from"./dialog-CHCQddYa.js";import{S as oe,a as re,b as ne,c as se,d as ce}from"./select-CTrUruAo.js";import{u as Fe}from"./use-breadcrumbs-DvJ2nCC4.js";import{t as y,T as Ve}from"./index-DFbpA4fk.js";import{P as ze}from"./plus-D0DLMzuz.js";import{S as Be}from"./search-D5tqskJn.js";import{M as ae}from"./map-pin-BdnUJoKD.js";import{T as qe}from"./trash-2-bbn3I8ZM.js";import"./index-oQJ4WyGj.js";import"./check-BUYNMoAp.js";function ue(t,o=[]){let r=[];function c(n,l){const i=u.createContext(l),f=r.length;r=[...r,l];const v=m=>{var S;const{scope:x,children:b,...N}=m,C=((S=x==null?void 0:x[t])==null?void 0:S[f])||i,j=u.useMemo(()=>N,Object.values(N));return e.jsx(C.Provider,{value:j,children:b})};v.displayName=n+"Provider";function d(m,x){var C;const b=((C=x==null?void 0:x[t])==null?void 0:C[f])||i,N=u.useContext(b);if(N)return N;if(l!==void 0)return l;throw new Error(`\`${m}\` must be used within \`${n}\``)}return[v,d]}const s=()=>{const n=r.map(l=>u.createContext(l));return function(i){const f=(i==null?void 0:i[t])||n;return u.useMemo(()=>({[`__scope${t}`]:{...i,[t]:f}}),[i,f])}};return s.scopeName=t,[c,Ge(s,...o)]}function Ge(...t){const o=t[0];if(t.length===1)return o;const r=()=>{const c=t.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(n){const l=c.reduce((i,{useScope:f,scopeName:v})=>{const m=f(n)[`__scope${v}`];return{...i,...m}},{});return u.useMemo(()=>({[`__scope${o.scopeName}`]:l}),[l])}};return r.scopeName=o.scopeName,r}function ie(t,o){if(typeof t=="function")return t(o);t!=null&&(t.current=o)}function Ke(...t){return o=>{let r=!1;const c=t.map(s=>{const n=ie(s,o);return!r&&typeof n=="function"&&(r=!0),n});if(r)return()=>{for(let s=0;s<c.length;s++){const n=c[s];typeof n=="function"?n():ie(t[s],null)}}}}function q(...t){return u.useCallback(Ke(...t),t)}function Ue(t){const o=t+"CollectionProvider",[r,c]=ue(o),[s,n]=r(o,{collectionRef:{current:null},itemMap:new Map}),l=C=>{const{scope:j,children:S}=C,h=g.useRef(null),A=g.useRef(new Map).current;return e.jsx(s,{scope:j,itemMap:A,collectionRef:h,children:S})};l.displayName=o;const i=t+"CollectionSlot",f=B(i),v=g.forwardRef((C,j)=>{const{scope:S,children:h}=C,A=n(i,S),w=q(j,A.collectionRef);return e.jsx(f,{ref:w,children:h})});v.displayName=i;const d=t+"CollectionItemSlot",m="data-radix-collection-item",x=B(d),b=g.forwardRef((C,j)=>{const{scope:S,children:h,...A}=C,w=g.useRef(null),_=q(j,w),R=n(d,S);return g.useEffect(()=>(R.itemMap.set(w,{ref:w,...A}),()=>void R.itemMap.delete(w))),e.jsx(x,{[m]:"",ref:_,children:h})});b.displayName=d;function N(C){const j=n(t+"CollectionConsumer",C);return g.useCallback(()=>{const h=j.collectionRef.current;if(!h)return[];const A=Array.from(h.querySelectorAll(`[${m}]`));return Array.from(j.itemMap.values()).sort((R,M)=>A.indexOf(R.ref.current)-A.indexOf(M.ref.current))},[j.collectionRef,j.itemMap])}return[{Provider:l,Slot:v,ItemSlot:b},N,c]}function He(t,o,{checkForDefaultPrevented:r=!0}={}){return function(s){if(t==null||t(s),r===!1||!s.defaultPrevented)return o==null?void 0:o(s)}}var me=globalThis!=null&&globalThis.document?u.useLayoutEffect:()=>{},Ye=le[" useInsertionEffect ".trim().toString()]||me;function pe({prop:t,defaultProp:o,onChange:r=()=>{},caller:c}){const[s,n,l]=Je({defaultProp:o,onChange:r}),i=t!==void 0,f=i?t:s;{const d=u.useRef(t!==void 0);u.useEffect(()=>{const m=d.current;m!==i&&console.warn(`${c} is changing from ${m?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=i},[i,c])}const v=u.useCallback(d=>{var m;if(i){const x=Qe(d)?d(t):d;x!==t&&((m=l.current)==null||m.call(l,x))}else n(d)},[i,t,n,l]);return[f,v]}function Je({defaultProp:t,onChange:o}){const[r,c]=u.useState(t),s=u.useRef(r),n=u.useRef(o);return Ye(()=>{n.current=o},[o]),u.useEffect(()=>{var l;s.current!==r&&((l=n.current)==null||l.call(n,r),s.current=r)},[r,s]),[r,c,n]}function Qe(t){return typeof t=="function"}var We=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],fe=We.reduce((t,o)=>{const r=B(`Primitive.${o}`),c=u.forwardRef((s,n)=>{const{asChild:l,...i}=s,f=l?r:o;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(f,{...i,ref:n})});return c.displayName=`Primitive.${o}`,{...t,[o]:c}},{}),Xe=le[" useId ".trim().toString()]||(()=>{}),Ze=0;function et(t){const[o,r]=u.useState(Xe());return me(()=>{r(c=>c??String(Ze++))},[t]),o?`radix-${o}`:""}var tt=u.createContext(void 0);function ot(t){const o=u.useContext(tt);return t||o||"ltr"}var I="Accordion",rt=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[U,nt,st]=Ue(I),[T,Dt]=ue(I,[st,de]),H=de(),xe=g.forwardRef((t,o)=>{const{type:r,...c}=t,s=c,n=c;return e.jsx(U.Provider,{scope:t.__scopeAccordion,children:r==="multiple"?e.jsx(lt,{...n,ref:o}):e.jsx(it,{...s,ref:o})})});xe.displayName=I;var[he,ct]=T(I),[ve,at]=T(I,{collapsible:!1}),it=g.forwardRef((t,o)=>{const{value:r,defaultValue:c,onValueChange:s=()=>{},collapsible:n=!1,...l}=t,[i,f]=pe({prop:r,defaultProp:c??"",onChange:s,caller:I});return e.jsx(he,{scope:t.__scopeAccordion,value:g.useMemo(()=>i?[i]:[],[i]),onItemOpen:f,onItemClose:g.useCallback(()=>n&&f(""),[n,f]),children:e.jsx(ve,{scope:t.__scopeAccordion,collapsible:n,children:e.jsx(Ce,{...l,ref:o})})})}),lt=g.forwardRef((t,o)=>{const{value:r,defaultValue:c,onValueChange:s=()=>{},...n}=t,[l,i]=pe({prop:r,defaultProp:c??[],onChange:s,caller:I}),f=g.useCallback(d=>i((m=[])=>[...m,d]),[i]),v=g.useCallback(d=>i((m=[])=>m.filter(x=>x!==d)),[i]);return e.jsx(he,{scope:t.__scopeAccordion,value:l,onItemOpen:f,onItemClose:v,children:e.jsx(ve,{scope:t.__scopeAccordion,collapsible:!0,children:e.jsx(Ce,{...n,ref:o})})})}),[dt,L]=T(I),Ce=g.forwardRef((t,o)=>{const{__scopeAccordion:r,disabled:c,dir:s,orientation:n="vertical",...l}=t,i=g.useRef(null),f=q(i,o),v=nt(r),m=ot(s)==="ltr",x=He(t.onKeyDown,b=>{var D;if(!rt.includes(b.key))return;const N=b.target,C=v().filter(a=>{var p;return!((p=a.ref.current)!=null&&p.disabled)}),j=C.findIndex(a=>a.ref.current===N),S=C.length;if(j===-1)return;b.preventDefault();let h=j;const A=0,w=S-1,_=()=>{h=j+1,h>w&&(h=A)},R=()=>{h=j-1,h<A&&(h=w)};switch(b.key){case"Home":h=A;break;case"End":h=w;break;case"ArrowRight":n==="horizontal"&&(m?_():R());break;case"ArrowDown":n==="vertical"&&_();break;case"ArrowLeft":n==="horizontal"&&(m?R():_());break;case"ArrowUp":n==="vertical"&&R();break}const M=h%S;(D=C[M].ref.current)==null||D.focus()});return e.jsx(dt,{scope:r,disabled:c,direction:s,orientation:n,children:e.jsx(U.Slot,{scope:r,children:e.jsx(fe.div,{...l,"data-orientation":n,ref:f,onKeyDown:c?void 0:x})})})}),O="AccordionItem",[ut,Y]=T(O),je=g.forwardRef((t,o)=>{const{__scopeAccordion:r,value:c,...s}=t,n=L(O,r),l=ct(O,r),i=H(r),f=et(),v=c&&l.value.includes(c)||!1,d=n.disabled||t.disabled;return e.jsx(ut,{scope:r,open:v,disabled:d,triggerId:f,children:e.jsx(De,{"data-orientation":n.orientation,"data-state":we(v),...i,...s,ref:o,disabled:d,open:v,onOpenChange:m=>{m?l.onItemOpen(c):l.onItemClose(c)}})})});je.displayName=O;var ge="AccordionHeader",be=g.forwardRef((t,o)=>{const{__scopeAccordion:r,...c}=t,s=L(I,r),n=Y(ge,r);return e.jsx(fe.h3,{"data-orientation":s.orientation,"data-state":we(n.open),"data-disabled":n.disabled?"":void 0,...c,ref:o})});be.displayName=ge;var G="AccordionTrigger",Ne=g.forwardRef((t,o)=>{const{__scopeAccordion:r,...c}=t,s=L(I,r),n=Y(G,r),l=at(G,r),i=H(r);return e.jsx(U.ItemSlot,{scope:r,children:e.jsx(ke,{"aria-disabled":n.open&&!l.collapsible||void 0,"data-orientation":s.orientation,id:n.triggerId,...i,...c,ref:o})})});Ne.displayName=G;var Se="AccordionContent",Ae=g.forwardRef((t,o)=>{const{__scopeAccordion:r,...c}=t,s=L(I,r),n=Y(Se,r),l=H(r);return e.jsx(Oe,{role:"region","aria-labelledby":n.triggerId,"data-orientation":s.orientation,...l,...c,ref:o,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...t.style}})});Ae.displayName=Se;function we(t){return t?"open":"closed"}var mt=xe,pt=je,ft=be,ye=Ne,Ie=Ae;const xt=mt,_e=u.forwardRef(({className:t,...o},r)=>e.jsx(pt,{ref:r,className:K("border-b",t),...o}));_e.displayName="AccordionItem";const Re=u.forwardRef(({className:t,children:o,...r},c)=>e.jsx(ft,{className:"flex",children:e.jsxs(ye,{ref:c,className:K("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",t),...r,children:[o,e.jsx(Te,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));Re.displayName=ye.displayName;const Ee=u.forwardRef(({className:t,children:o,...r},c)=>e.jsx(Ie,{ref:c,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...r,children:e.jsx("div",{className:K("pb-4 pt-0",t),children:o})}));Ee.displayName=Ie.displayName;function kt({provinces:t,flash:o}){var D;const{userBreadcrumbs:r}=Fe(),c=((D=r.sectors)==null?void 0:D.index())||[],[s,n]=u.useState(""),[l,i]=u.useState(!1),[f,v]=u.useState(!1),[d,m]=u.useState(!1),[x,b]=u.useState({name:"",province_id:""}),[N,C]=u.useState({id:0,name:"",province_id:""});u.useEffect(()=>{o!=null&&o.success&&y.success(o.success),o!=null&&o.error&&y.error(o.error)},[o]),u.useEffect(()=>{const a=p=>{p.key==="Escape"&&(l&&h(),f&&_())};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[l,f]);const j=u.useMemo(()=>{if(!s)return t;const a=s.toLowerCase();return t.map(p=>{const P=p.cities.filter(Pe=>Pe.name.toLowerCase().includes(a)),J=p.name.toLowerCase().includes(a);return!J&&P.length===0?null:J?p:{...p,cities:P}}).filter(p=>p!==null)},[s,t]),S=()=>{b({name:"",province_id:""}),i(!0)},h=()=>{i(!1),b({name:"",province_id:""})},A=async a=>{if(a.preventDefault(),!x.name.trim()||!x.province_id){y.error("Por favor completa todos los campos");return}m(!0);try{$.post(F("user.sectors.store"),x,{preserveScroll:!0,onSuccess:()=>{y.success("Ciudad creada correctamente"),h()},onError:p=>{const P=Object.values(p)[0];y.error(P||"Error al crear la ciudad")},onFinish:()=>{m(!1)}})}catch{y.error("Error inesperado al crear la ciudad"),m(!1)}},w=a=>{C({id:a.id,name:a.name,province_id:a.province_id.toString()}),v(!0)},_=()=>{v(!1),C({id:0,name:"",province_id:""})},R=async a=>{if(a.preventDefault(),!N.name.trim()||!N.province_id){y.error("Por favor completa todos los campos");return}m(!0);try{$.put(F("user.sectors.update",N.id),{name:N.name,province_id:N.province_id},{preserveScroll:!0,onSuccess:()=>{y.success("Ciudad actualizada correctamente"),_()},onError:p=>{const P=Object.values(p)[0];y.error(P||"Error al actualizar la ciudad")},onFinish:()=>{m(!1)}})}catch{y.error("Error inesperado al actualizar la ciudad"),m(!1)}},M=a=>{y.error(`¿Estás seguro de eliminar "${a.name}"?`,{description:"Esta acción no se puede deshacer.",action:{label:"Confirmar",onClick:()=>{$.delete(F("user.sectors.destroy",a.id),{preserveScroll:!0})}},cancel:{label:"Cancelar",onClick:()=>{}}})};return e.jsxs(Le,{breadcrumbs:c,children:[e.jsx(Me,{title:"Gestión de Sectores"}),e.jsx(Ve,{position:"top-center",richColors:!0}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Gestión de Sectores"}),e.jsx("p",{className:"text-muted-foreground",children:"Administra las provincias y ciudades del sistema."})]}),e.jsxs(E,{onClick:S,className:"flex items-center space-x-2",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{children:"Nueva Ciudad"})]})]}),e.jsx(V,{className:"p-4",children:e.jsx("div",{className:"flex flex-col md:flex-row gap-4 items-end",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Buscar sector"}),e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(z,{type:"text",placeholder:"Buscar por provincia o ciudad...",value:s,onChange:a=>n(a.target.value),className:"pl-10"})]})]})})}),e.jsx("div",{className:"grid gap-4",children:j.length>0?e.jsx(V,{children:e.jsx(xt,{type:"multiple",className:"w-full",children:j.map(a=>e.jsxs(_e,{value:`province-${a.id}`,children:[e.jsx(Re,{className:"px-6 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ae,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"font-semibold text-lg",children:a.name}),e.jsxs("span",{className:"text-sm text-gray-400",children:["(",a.cities.length," ",a.cities.length===1?"ciudad":"ciudades",")"]})]})}),e.jsx(Ee,{className:"px-6 pt-2 pb-4 bg-white",children:a.cities.length>0?e.jsx("ul",{className:"space-y-2",children:a.cities.map(p=>e.jsxs("li",{className:"flex items-center justify-between p-2 rounded-md hover:bg-gray-50",children:[e.jsx("span",{children:p.name}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{variant:"outline",size:"sm",onClick:()=>w(p),children:e.jsx($e,{className:"h-4 w-4"})}),e.jsx(E,{variant:"outline",size:"sm",onClick:()=>M(p),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(qe,{className:"h-4 w-4"})})]})]},p.id))}):e.jsx("p",{className:"text-sm text-center text-gray-500 py-4",children:"No hay ciudades que coincidan con la búsqueda en esta provincia."})})]},a.id))})}):e.jsxs(V,{className:"p-8 text-center",children:[e.jsx(ae,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"No se encontraron sectores"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"El filtro no arrojó resultados. Intenta con otro término de búsqueda."})]})})]}),e.jsx(Q,{open:l,onOpenChange:i,children:e.jsxs(W,{className:"sm:max-w-[425px]",children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Nueva Ciudad"}),e.jsx(ee,{children:"Agrega una nueva ciudad al sistema. Selecciona la provincia correspondiente."})]}),e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"create-province",children:"Provincia"}),e.jsxs(oe,{value:x.province_id,onValueChange:a=>b(p=>({...p,province_id:a})),children:[e.jsx(re,{id:"create-province",children:e.jsx(ne,{placeholder:"Selecciona una provincia"})}),e.jsx(se,{children:t.map(a=>e.jsx(ce,{value:a.id.toString(),children:a.name},a.id))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"create-name",children:"Nombre de la Ciudad"}),e.jsx(z,{id:"create-name",type:"text",placeholder:"Ingresa el nombre de la ciudad",value:x.name,onChange:a=>b(p=>({...p,name:a.target.value})),disabled:d})]})]}),e.jsxs(te,{children:[e.jsx(E,{type:"button",variant:"outline",onClick:h,disabled:d,children:"Cancelar"}),e.jsx(E,{type:"submit",disabled:d,children:d?"Creando...":"Crear Ciudad"})]})]})]})}),e.jsx(Q,{open:f,onOpenChange:v,children:e.jsxs(W,{className:"sm:max-w-[425px]",children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Editar Ciudad"}),e.jsx(ee,{children:"Modifica los datos de la ciudad seleccionada."})]}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"edit-province",children:"Provincia"}),e.jsxs(oe,{value:N.province_id,onValueChange:a=>C(p=>({...p,province_id:a})),children:[e.jsx(re,{id:"edit-province",children:e.jsx(ne,{placeholder:"Selecciona una provincia"})}),e.jsx(se,{children:t.map(a=>e.jsx(ce,{value:a.id.toString(),children:a.name},a.id))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"edit-name",children:"Nombre de la Ciudad"}),e.jsx(z,{id:"edit-name",type:"text",placeholder:"Ingresa el nombre de la ciudad",value:N.name,onChange:a=>C(p=>({...p,name:a.target.value})),disabled:d})]})]}),e.jsxs(te,{children:[e.jsx(E,{type:"button",variant:"outline",onClick:_,disabled:d,children:"Cancelar"}),e.jsx(E,{type:"submit",disabled:d,children:d?"Actualizando...":"Actualizar Ciudad"})]})]})]})})]})}export{kt as default};
